// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model OnboardingProcess {
  id          String   @id @default(uuid())
  title       String
  description String
  phases      Phase[]
  createdAt   DateTime @default(now())
}

model Phase {
  id        String     @id @default(uuid())
  title     String
  order     Int
  processId String
  process   OnboardingProcess @relation(fields: [processId], references: [id])
  questions Question[]
  employees Employee[] // Relação para saber em qual fase o funcionário está
}

model Question {
  id        String   @id @default(uuid())
  label     String
  type      String   // TEXT, DATE, SELECT, FILE
  required  Boolean  @default(false)
  order     Int
  options   Option[]
  phaseId   String
  phase     Phase    @relation(fields: [phaseId], references: [id])
  answers   Answer[]
}

model Option {
  id         String   @id @default(uuid())
  label      String
  value      String
  order      Int
  questionId String
  question   Question @relation(fields: [questionId], references: [id])
}

// --- TABELA 1: FUNCIONÁRIO (Somente Identificação) ---
model Employee {
  id             String    @id @default(uuid())
  name           String
  email          String    @unique
  cpf            String    @unique
  createdAt      DateTime  @default(now())
  
  currentPhaseId String
  currentPhase   Phase     @relation(fields: [currentPhaseId], references: [id])
  
  // Relações (Chaves Estrangeiras)
  address        Address?  // 1 Funcionário tem 1 Endereço (Opcional no cadastro inicial)
  documents      Document[] // 1 Funcionário tem Vários Documentos
  answers        Answer[]
}

// --- TABELA 2: ENDEREÇO (Separado conforme BCNF) ---
model Address {
  id           String   @id @default(uuid())
  cep          String
  street       String
  number       String
  complement   String?
  neighborhood String
  city         String
  state        String
  
  employeeId   String   @unique // @unique garante relação 1:1
  employee     Employee @relation(fields: [employeeId], references: [id])
}

// --- TABELA 3: DOCUMENTOS/IMAGENS (Separado para não pesar) ---
model Document {
  id          String   @id @default(uuid())
  fileName    String
  mimeType    String
  fileData    Bytes    // O binário pesado fica aqui
  uploadedAt  DateTime @default(now())

  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id])

  // Opcional: Linkar com uma resposta específica do formulário
  answerId    String?  @unique
  answer      Answer?  @relation(fields: [answerId], references: [id])
}

model Answer {
  id          String   @id @default(uuid())
  value       String?  // Texto ou Data
  
  // Se for arquivo, guardamos só o link/referência, não o binário
  document    Document?

  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id])
  
  questionId  String
  question    Question @relation(fields: [questionId], references: [id])

  @@unique([employeeId, questionId])
}